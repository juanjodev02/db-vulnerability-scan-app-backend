import { Controller, Get, Param, Res } from '@nestjs/common';
import { Response } from 'express';
import { AppService } from './app.service';

@Controller('api')
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get('/databases')
  getDatabases() {
    return this.appService.getDatabases();
  }

  @Get('/database/:id/logs')
  getLogs(@Param('id') id: string, @Res() res: Response) {
    return this.appService.downloadAnalysisJson(+id, res);
  }

  @Get('/databases/:databaseId/analysis')
  createAnalysis(@Param('databaseId') databaseId: string) {
    console.log(databaseId);
    return this.appService.analyzeDatabase(+databaseId);
  }
}
